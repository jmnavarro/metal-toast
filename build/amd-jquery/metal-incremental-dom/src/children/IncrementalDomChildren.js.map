{"version":3,"sources":["IncrementalDomChildren.js"],"names":["IncrementalDomChildren","renderer","callback","renderer_","callback_","tree_","props","children","config","currentParent_","isCapturing_","startInterception","elementClose","handleInterceptedCloseCall_","elementOpen","handleInterceptedOpenCall_","text","handleInterceptedTextCall_","currNodeOwner_","node","CHILD_OWNER","tree","opt_skipNode","addChildToTree","getOwner","args","IncrementalDOM","apply","buildCallFromConfig","tag","i","length","render","addChildCallToTree_","opt_isText","child","parent","buildConfigFromCall","push","stopInterception","originalFn"],"mappings":"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","file":"node_modules/metal-incremental-dom/src/children/IncrementalDomChildren.js","sourcesContent":["'use strict';\n\nimport { isDef } from 'metal';\nimport IncrementalDomAop from '../IncrementalDomAop';\nimport IncrementalDomUtils from '../utils/IncrementalDomUtils';\n\n/**\n * Provides helpers for capturing children elements from incremental dom calls,\n * as well as actually rendering those captured children via incremental dom\n * later.\n */\nclass IncrementalDomChildren {\n\t/**\n\t * Captures all child elements from incremental dom calls.\n\t * @param {!IncrementalDomRenderer} renderer The renderer that is capturing\n\t *   children.\n\t * @param {!function()} callback Function to be called when children have all\n\t *     been captured.\n \t */\n\tstatic capture(renderer, callback) {\n\t\trenderer_ = renderer;\n\t\tcallback_ = callback;\n\t\ttree_ = {\n\t\t\tprops: {\n\t\t\t\tchildren: []\n\t\t\t}\n\t\t};\n\t\ttree_.config = tree_.props;\n\t\tcurrentParent_ = tree_;\n\t\tisCapturing_ = true;\n\t\tIncrementalDomAop.startInterception({\n\t\t\telementClose: handleInterceptedCloseCall_,\n\t\t\telementOpen: handleInterceptedOpenCall_,\n\t\t\ttext: handleInterceptedTextCall_\n\t\t});\n\t}\n\n\t/**\n\t * Returns the owner of the current child node being rendered (or nothing\n\t * if there's no child being rendered).\n\t * @return {ComponentRenderer}\n\t */\n\tstatic getCurrentOwner() {\n\t\treturn currNodeOwner_;\n\t}\n\n\t/**\n\t * Gets the node's original owner's renderer.\n\t * @param {!Object} node\n\t * @return {ComponentRenderer}\n\t */\n\tstatic getOwner(node) {\n\t\treturn node[IncrementalDomChildren.CHILD_OWNER];\n\t}\n\n\t/**\n\t * Renders a children tree through incremental dom.\n\t * @param {!{args: Array, children: !Array, isText: ?boolean}}\n\t * @param {function()=} opt_skipNode Optional function that is called for\n\t *     each node to be rendered. If it returns true, the node will be skipped.\n\t * @protected\n\t */\n\tstatic render(tree, opt_skipNode) {\n\t\tif (isCapturing_) {\n\t\t\t// If capturing, just add the node directly to the captured tree.\n\t\t\taddChildToTree(tree);\n\t\t\treturn;\n\t\t}\n\n\t\tcurrNodeOwner_ = IncrementalDomChildren.getOwner(tree);\n\t\tif (opt_skipNode && opt_skipNode(tree)) {\n\t\t\tcurrNodeOwner_ = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (isDef(tree.text)) {\n\t\t\tlet args = tree.args ? tree.args : [];\n\t\t\targs[0] = tree.text;\n\t\t\tIncrementalDOM.text.apply(null, args);\n\t\t} else {\n\t\t\tlet args = IncrementalDomUtils.buildCallFromConfig(tree.tag, tree.props);\n\t\t\tIncrementalDOM.elementOpen.apply(null, args);\n\t\t\tif (tree.props.children) {\n\t\t\t\tfor (var i = 0; i < tree.props.children.length; i++) {\n\t\t\t\t\tIncrementalDomChildren.render(tree.props.children[i], opt_skipNode);\n\t\t\t\t}\n\t\t\t}\n\t\t\tIncrementalDOM.elementClose(tree.tag);\n\t\t}\n\t\tcurrNodeOwner_ = null;\n\t}\n}\n\nvar callback_;\nvar currNodeOwner_;\nvar currentParent_;\nvar isCapturing_ = false;\nvar renderer_;\nvar tree_;\n\n/**\n * Adds a child element to the tree.\n * @param {!Array} args The arguments passed to the incremental dom call.\n * @param {boolean=} opt_isText Optional flag indicating if the child is a\n *     text element.\n * @protected\n */\nfunction addChildCallToTree_(args, opt_isText) {\n\tvar child = {\n\t\tparent: currentParent_,\n\t\t[IncrementalDomChildren.CHILD_OWNER]: renderer_\n\t};\n\n\tif (opt_isText) {\n\t\tchild.text = args[0];\n\t\tif (args.length > 1) {\n\t\t\tchild.args = args;\n\t\t}\n\t} else {\n\t\tchild.tag = args[0];\n\t\tchild.props = IncrementalDomUtils.buildConfigFromCall(args);\n\t\tchild.props.children = [];\n\t\tchild.config = child.props;\n\t}\n\n\taddChildToTree(child);\n\treturn child;\n}\n\nfunction addChildToTree(child) {\n\tcurrentParent_.props.children.push(child);\n}\n\n/**\n * Handles an intercepted call to the `elementClose` function from incremental\n * dom.\n * @protected\n */\nfunction handleInterceptedCloseCall_() {\n\tif (currentParent_ === tree_) {\n\t\tIncrementalDomAop.stopInterception();\n\t\tisCapturing_ = false;\n\t\tcallback_(tree_);\n\t\tcallback_ = null;\n\t\tcurrentParent_ = null;\n\t\trenderer_ = null;\n\t\ttree_ = null;\n\t} else {\n\t\tcurrentParent_ = currentParent_.parent;\n\t}\n}\n\n/**\n * Handles an intercepted call to the `elementOpen` function from incremental\n * dom.\n * @param {!function()} originalFn The original function before interception.\n * @protected\n */\nfunction handleInterceptedOpenCall_(originalFn, ...args) {\n\tcurrentParent_ = addChildCallToTree_(args);\n}\n\n/**\n * Handles an intercepted call to the `text` function from incremental dom.\n * @param {!function()} originalFn The original function before interception.\n * @protected\n */\nfunction handleInterceptedTextCall_(originalFn, ...args) {\n\taddChildCallToTree_(args, true);\n}\n\n\n/**\n * Property identifying a specific object as a Metal.js child node, and\n * pointing to the renderer instance that created it.\n * @type {string}\n * @static\n */\nIncrementalDomChildren.CHILD_OWNER = '__metalChildOwner';\n\nexport default IncrementalDomChildren;\n"],"sourceRoot":"/source/"}