{"version":3,"sources":["globalEval.js"],"names":["globalEval","text","opt_appendFn","script","document","createElement","head","appendChild","exitDocument","src","opt_callback","callback","once","type","nextTick","runFile","run","element","scripts","querySelectorAll","length","runScriptsInOrder","index","runScript","item"],"mappings":";AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAQMA,U;;;;;;;uBAQMC,I,EAAMC,Y,EAAc;AAC9B,QAAIC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAb;AACAF,WAAOF,IAAP,GAAcA,IAAd;AACA,QAAIC,YAAJ,EAAkB;AACjBA,kBAAaC,MAAb;AACA,KAFD,MAEO;AACNC,cAASE,IAAT,CAAcC,WAAd,CAA0BJ,MAA1B;AACA;AACD,kBAAIK,YAAJ,CAAiBL,MAAjB;AACA,WAAOA,MAAP;AACA;;;2BAWcM,G,EAAKC,Y,EAAcR,Y,EAAc;AAC/C,QAAIC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAb;AACAF,WAAOM,GAAP,GAAaA,GAAb;;AAEA,QAAIE,WAAW,SAAXA,QAAW,GAAW;AACzB,mBAAIH,YAAJ,CAAiBL,MAAjB;AACAO,qBAAgBA,cAAhB;AACA,KAHD;AAIA,kBAAIE,IAAJ,CAAST,MAAT,EAAiB,MAAjB,EAAyBQ,QAAzB;AACA,kBAAIC,IAAJ,CAAST,MAAT,EAAiB,OAAjB,EAA0BQ,QAA1B;;AAEA,QAAIT,YAAJ,EAAkB;AACjBA,kBAAaC,MAAb;AACA,KAFD,MAEO;AACNC,cAASE,IAAT,CAAcC,WAAd,CAA0BJ,MAA1B;AACA;;AAED,WAAOA,MAAP;AACA;;;6BAWgBA,M,EAAQO,Y,EAAcR,Y,EAAc;AACpD,QAAIS,WAAW,SAAXA,QAAW,GAAW;AACzBD,qBAAgBA,cAAhB;AACA,KAFD;AAGA,QAAIP,OAAOU,IAAP,IAAeV,OAAOU,IAAP,KAAgB,iBAAnC,EAAsD;AACrD,kBAAMC,QAAN,CAAeH,QAAf;AACA;AACA;AACD,kBAAIH,YAAJ,CAAiBL,MAAjB;AACA,QAAIA,OAAOM,GAAX,EAAgB;AACf,YAAOT,WAAWe,OAAX,CAAmBZ,OAAOM,GAA1B,EAA+BC,YAA/B,EAA6CR,YAA7C,CAAP;AACA,KAFD,MAEO;AACN,kBAAMY,QAAN,CAAeH,QAAf;AACA,YAAOX,WAAWgB,GAAX,CAAeb,OAAOF,IAAtB,EAA4BC,YAA5B,CAAP;AACA;AACD;;;uCAU0Be,O,EAASP,Y,EAAcR,Y,EAAc;AAC/D,QAAIgB,UAAUD,QAAQE,gBAAR,CAAyB,QAAzB,CAAd;AACA,QAAID,QAAQE,MAAZ,EAAoB;AACnBpB,gBAAWqB,iBAAX,CAA6BH,OAA7B,EAAsC,CAAtC,EAAyCR,YAAzC,EAAuDR,YAAvD;AACA,KAFD,MAEO,IAAIQ,YAAJ,EAAkB;AACxB,kBAAMI,QAAN,CAAeJ,YAAf;AACA;AACD;;;qCAWwBQ,O,EAASI,K,EAAOZ,Y,EAAcR,Y,EAAc;AACpEF,eAAWuB,SAAX,CAAqBL,QAAQM,IAAR,CAAaF,KAAb,CAArB,EAA0C,YAAW;AACpD,SAAIA,QAAQJ,QAAQE,MAAR,GAAiB,CAA7B,EAAgC;AAC/BpB,iBAAWqB,iBAAX,CAA6BH,OAA7B,EAAsCI,QAAQ,CAA9C,EAAiDZ,YAAjD,EAA+DR,YAA/D;AACA,MAFD,MAEO,IAAIQ,YAAJ,EAAkB;AACxB,mBAAMI,QAAN,CAAeJ,YAAf;AACA;AACD,KAND,EAMGR,YANH;AAOA;;;;;;mBAGaF,U","file":"node_modules/metal-dom/src/globalEval.js","sourcesContent":["'use strict';\n\nimport { async } from 'metal';\nimport dom from './dom';\n\n/**\n * Utility functions for running javascript code in the global scope.\n */\nclass globalEval {\n\t/**\n\t * Evaluates the given string in the global scope.\n\t * @param {string} text\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic run(text, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.text = text;\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\t\tdom.exitDocument(script);\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the given javascript file in the global scope.\n\t * @param {string} src The file's path.\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runFile(src, opt_callback, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.src = src;\n\n\t\tvar callback = function() {\n\t\t\tdom.exitDocument(script);\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tdom.once(script, 'load', callback);\n\t\tdom.once(script, 'error', callback);\n\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the code referenced by the given script element.\n\t * @param {!Element} script\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runScript(script, opt_callback, opt_appendFn) {\n\t\tvar callback = function() {\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tif (script.type && script.type !== 'text/javascript') {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn;\n\t\t}\n\t\tdom.exitDocument(script);\n\t\tif (script.src) {\n\t\t\treturn globalEval.runFile(script.src, opt_callback, opt_appendFn);\n\t\t} else {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn globalEval.run(script.text, opt_appendFn);\n\t\t}\n\t}\n\n\t/**\n\t * Evaluates any script tags present in the given element.\n\t * @params {!Element} element\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInElement(element, opt_callback, opt_appendFn) {\n\t\tvar scripts = element.querySelectorAll('script');\n\t\tif (scripts.length) {\n\t\t\tglobalEval.runScriptsInOrder(scripts, 0, opt_callback, opt_appendFn);\n\t\t} else if (opt_callback) {\n\t\t\tasync.nextTick(opt_callback);\n\t\t}\n\t}\n\n\t/**\n\t * Runs the given scripts elements in the order that they appear.\n\t * @param {!NodeList} scripts\n\t * @param {number} index\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInOrder(scripts, index, opt_callback, opt_appendFn) {\n\t\tglobalEval.runScript(scripts.item(index), function() {\n\t\t\tif (index < scripts.length - 1) {\n\t\t\t\tglobalEval.runScriptsInOrder(scripts, index + 1, opt_callback, opt_appendFn);\n\t\t\t} else if (opt_callback) {\n\t\t\t\tasync.nextTick(opt_callback);\n\t\t\t}\n\t\t}, opt_appendFn);\n\t}\n}\n\nexport default globalEval;\n"],"sourceRoot":"/source/"}