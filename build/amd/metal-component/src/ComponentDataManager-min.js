define(["exports","metal/src/metal","metal-events/src/events","metal-state/src/all/state"],function(t,e,n,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(a),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),l=function p(t,e,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,e);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:p(r,e,n)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(n)},f=function(t){function a(t,n){o(this,a);var r=i(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return r.component_=t,(0,e.mergeSuperClassesProperty)(r.constructor,"BLACKLIST",e.array.firstDefinedValue),u["default"].mergeStateStatic(r.component_.constructor),r.createState_(n,r.component_),r}return s(a,t),c(a,[{key:"add",value:function(){var t;(t=this.state_).addToState.apply(t,arguments)}},{key:"buildStateInstanceData_",value:function(t){return e.object.mixin({},t,this.component_.constructor.STATE_MERGED)}},{key:"createState_",value:function(t,e){var a=new u["default"]({},e,this.component_);a.setKeysBlacklist_(this.constructor.BLACKLIST_MERGED),a.addToState(this.buildStateInstanceData_(t),this.component_.getInitialConfig());var r=this.emit_.bind(this);a.on("stateChanged",r),a.on("stateKeyChanged",r),this.state_=a,this.proxy_=new n.EventEmitterProxy(a,this.component_)}},{key:"disposeInternal",value:function(){l(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"disposeInternal",this).call(this),this.state_.dispose(),this.state_=null,this.proxy_.dispose(),this.proxy_=null}},{key:"emit_",value:function(t,e){var n=e.type,a="stateChanged"===n?"dataChanged":"dataPropChanged";this.emit(a,t)}},{key:"get",value:function(t){return this.state_.get(t)}},{key:"getSyncKeys",value:function(){return this.state_.getStateKeys()}},{key:"getStateKeys",value:function(){return this.state_.getStateKeys()}},{key:"getState",value:function(){return this.state_.getState()}},{key:"getStateInstance",value:function(){return this.state_}},{key:"replaceNonInternal",value:function(t){a.replaceNonInternal(t,this.state_)}},{key:"setState",value:function(t,e){this.state_.setState(t,e)}}],[{key:"replaceNonInternal",value:function(t,e){for(var n=e.getStateKeys(),a=0;a<n.length;a++){var r=n[a];e.getStateKeyConfig(r).internal||(t.hasOwnProperty(r)?e.set(r,t[r]):e.setDefaultValue(r))}}}]),a}(n.EventEmitter);f.BLACKLIST={components:!0,context:!0,element:!0,refs:!0,wasRendered:!0},t["default"]=f});